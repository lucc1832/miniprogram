<view class="container">
  <!-- Fixed Custom Navigation Bar -->
  <view class="custom-nav" style="height: {{statusBarHeight + navBarHeight}}px; padding-top: {{statusBarHeight}}px;">
    <view class="nav-content" style="height: {{navBarHeight}}px; line-height: {{navBarHeight}}px;">
      <view class="back-btn" bindtap="onBack" style="height: {{menuButtonHeight}}px; margin-top: {{menuButtonTop - statusBarHeight}}px;">
        <text class="back-icon">â®</text>
      </view>
      <view class="location-area" bindtap="onSwitchCity" style="height: {{menuButtonHeight}}px; margin-top: {{menuButtonTop - statusBarHeight}}px;">
        <text class="city-name">{{weatherData.city}}</text>
        <view class="location-icon">ğŸ“</view>
      </view>
      <view class="menu-btn" bindtap="onShowMenu" style="position: absolute; left: {{menuButtonLeft - 40}}px; top: {{menuButtonTop}}px; height: {{menuButtonHeight}}px; width: 40px; display: flex; align-items: center; justify-content: center; z-index: 1001;">
        <text style="font-size: 20px;">âš™ï¸</text>
      </view>
    </view>
  </view>

  <!-- Loading State -->
  <view class="loading" wx:if="{{loading}}">
    <view class="spinner"></view>
    <text>æ­£åœ¨è·å–å¤©æ°”...</text>
  </view>

  <block wx:else>
    <!-- Main Content Scroll (Swiper) -->
    <swiper 
      class="content-swiper" 
      current="{{currentCityIndex}}" 
      bindchange="onSwiperChange"
      bindtransition="onSwiperTransition"
      bindanimationfinish="onSwiperAnimationFinish"
      duration="300"
      style="height: 100vh;"
    >
      <block wx:for="{{cities}}" wx:key="name">
        <swiper-item>
          <scroll-view 
            scroll-y 
            class="content-scroll" 
            style="padding-top: {{statusBarHeight + navBarHeight}}px; height: 100%; box-sizing: border-box;" 
            enable-back-to-top
            refresher-enabled="{{true}}"
            bindrefresherrefresh="onPullDownRefresh"
            refresher-triggered="{{isRefreshing}}"
          >
            <!-- Content Wrapper to hold everything -->
            <view class="weather-content-wrapper">
              
              <!-- Main Weather Section -->
              <view class="main-section fade-in-up">
                <view class="temp-box">
                  <text class="temp-val">{{weatherData.temp}}Â°</text>
                </view>
                <view class="condition-box">
                  <text class="condition-text">{{weatherData.condition}}</text>
                  <view class="hl-temp">
                    <text>æœ€é«˜ {{weatherData.high}}Â°</text>
                    <text class="sep"> </text>
                    <text>æœ€ä½ {{weatherData.low}}Â°</text>
                  </view>
                </view>
                
                <!-- Air Quality Tag -->
                <view class="aqi-tag">
                  <text class="aqi-label">ç©ºæ°”{{weatherData.aqiLevel}}</text>
                  <text class="aqi-val">{{weatherData.aqi}}</text>
                </view>
              </view>

              <!-- Clothing Advice Card -->
              <view class="card clothing-card fade-in-up" style="animation-delay: 0.2s;">
                <view class="card-header">
                  <text class="card-icon">ğŸ‘•</text>
                  <text class="card-title">ç©¿è¡£å»ºè®®</text>
                </view>
                <view class="clothing-content">
                  <text class="clothing-text">ä»Šå¤©å¤©æ°”ä¸é”™ï¼Œé€‚åˆç©¿ä¸€ä»¶èˆ’é€‚çš„å«è¡£æ­é…ç‰›ä»”è£¤ï¼Œæ—¢ä¿æš–åˆæ—¶å°šã€‚</text>
                </view>
              </view>

              <!-- Hourly Forecast -->
              <view class="card hourly-card fade-in-up" style="animation-delay: 0.3s;">
                <view class="card-header">
                  <text class="card-icon">ğŸ•’</text>
                  <text class="card-title">24å°æ—¶é¢„æŠ¥</text>
                </view>
                <scroll-view scroll-x class="hourly-scroll" enable-flex>
                  <block wx:for="{{hourlyForecast}}" wx:key="time">
                    <view class="hourly-item">
                      <text class="h-time">{{item.time}}</text>
                      <view class="h-icon">{{item.icon}}</view>
                      <text class="h-temp">{{item.temp}}Â°</text>
                    </view>
                  </block>
                </scroll-view>
              </view>

              <!-- Daily Forecast -->
              <view class="card daily-card fade-in-up" style="animation-delay: 0.4s;">
                <view class="card-header">
                  <text class="card-icon">ğŸ“…</text>
                  <text class="card-title">æœªæ¥é¢„æŠ¥</text>
                </view>
                <view class="daily-list">
                  <block wx:for="{{dailyForecast}}" wx:key="day">
                    <view class="daily-row" wx:if="{{index < 7 || showAllDays}}">
                      <text class="d-day">{{item.day}}</text>
                      <view class="d-icon-box">
                        <text class="d-icon">{{item.icon}}</text>
                      </view>
                      <view class="d-temp-bar-container">
                        <text class="d-low">{{item.low}}Â°</text>
                        <view class="d-bar-bg">
                          <view class="d-bar-fill" style="left: {{item.barLeft}}%; width: {{item.barWidth}}%;"></view> 
                        </view>
                        <text class="d-high">{{item.high}}Â°</text>
                      </view>
                    </view>
                  </block>
                </view>
                <view class="expand-btn-container" bindtap="toggleForecast">
                    <view class="expand-btn">{{showAllDays ? 'æ”¶èµ·' : 'æœªæ¥ 15 æ—¥å¤©æ°”é¢„æŠ¥'}}</view>
                </view>
              </view>

              <!-- Details Grid -->
              <view class="details-grid fade-in-up" style="animation-delay: 0.5s;">
                <view class="detail-box">
                  <view class="d-label">ğŸ’¦ æ¹¿åº¦</view>
                  <view class="d-value">{{weatherData.humidity}}</view>
                </view>
                <view class="detail-box">
                  <view class="d-label">ğŸŒ¡ï¸ ä½“æ„Ÿ</view>
                  <view class="d-value">{{weatherData.feelsLike}}Â°</view>
                </view>
                <view class="detail-box">
                  <view class="d-label">ğŸŒ¬ï¸ é£å‘</view>
                  <view class="d-value-sm">{{weatherData.windDir}} {{weatherData.windSpeed}}</view>
                </view>
                <view class="detail-box">
                  <view class="d-label">ğŸˆ æ°”å‹</view>
                  <view class="d-value">{{weatherData.pressure}}</view>
                </view>
                <view class="detail-box">
                  <view class="d-label">ğŸ‘ï¸ èƒ½è§åº¦</view>
                  <view class="d-value">{{weatherData.visibility}}</view>
                </view>
                <view class="detail-box">
                  <view class="d-label">ğŸŒ§ï¸ é™é›¨æ¦‚ç‡</view>
                  <view class="d-value">{{weatherData.rainProb}}</view>
                </view>
                
                <!-- Sunrise Sunset Full Width -->
                <view class="detail-box sun-box">
                  <view class="d-label">ğŸŒ… æ—¥å‡ºæ—¥è½</view>
                  <view class="sun-times">
                     <view class="sun-item">
                       <text class="sun-label">æ—¥å‡º</text>
                       <text class="sun-time">{{weatherData.sunrise}}</text>
                     </view>
                     <view class="sun-visual">
                         <view class="sun-line"></view>
                         <view class="sun-dot" style="left: {{weatherData.sunPosition}}%;"></view>
                      </view>
                     <view class="sun-item right">
                       <text class="sun-label">æ—¥è½</text>
                       <text class="sun-time">{{weatherData.sunset}}</text>
                     </view>
                  </view>
                </view>
              </view>

              <view class="footer-safe-area"></view>
            </view>
          </scroll-view>
        </swiper-item>
      </block>
    </swiper>
    
    <!-- Page Indicators (Dots) -->
    <view class="indicators-container {{showIndicators ? 'show' : ''}}">
      <block wx:for="{{cities}}" wx:key="name">
        <view class="dot {{index === currentCityIndex ? 'active' : ''}}"></view>
      </block>
    </view>
  </block>
</view>