<view class="home-container" style="padding-top: {{statusBarHeight + navBarHeight}}px;">
  <!-- Custom Header Area -->
  <view class="custom-header" style="top: {{statusBarHeight}}px; height: {{navBarHeight}}px;">
    <view class="today-btn">今</view>
    <!-- Calendar Strip Placeholder -->
  </view>

  <!-- Calendar Strip -->
  <view class="calendar-strip">
    <view class="day-item" wx:for="{{weekDays}}" wx:key="date">
      <text class="week-text">{{item.week}}</text>
      <view class="date-circle {{item.active ? 'active' : ''}}">
        <text class="date-text">{{item.date}}</text>
      </view>
    </view>
  </view>

  <!-- Character Section -->
  <view class="character-section">
    <image class="character-img" src="https://img.yzcdn.cn/vant/cat.jpeg" mode="aspectFit"></image>
    <view class="bubble">
      <text wx:if="{{todayStatus === 'empty'}}">Thinking...🤔</text>
      <text wx:elif="{{todayStatus === 'planned'}}">Cooking...🧑‍🍳</text>
      <text wx:else>Yum! 😋</text>
    </view>
  </view>

  <!-- Toggle Buttons -->
  <view class="toggle-section">
    <view class="toggle-btn {{activeView === 'heat' ? 'active' : ''}}" bindtap="switchView" data-view="heat">热力图</view>
    <view class="toggle-btn {{activeView === 'cart' ? 'active' : ''}}" bindtap="switchView" data-view="cart">菜篮子</view>
  </view>

  <!-- Heatmap Card -->
  <view class="card heatmap-card" wx:if="{{activeView === 'heat'}}">
    <view class="card-header">
      <text class="card-title">年度做饭热力图</text>
      <view class="year-selector">
        <text class="arrow">❮</text>
        <text class="year">{{currentYear}}</text>
        <text class="arrow">❯</text>
      </view>
    </view>
    
    <view class="heatmap-grid">
      <view class="heatmap-row" wx:for="{{heatmapGrid}}" wx:key="month">
        <text class="month-label">{{item.month}}</text>
        <view class="squares">
          <view class="square" wx:for="{{item.squares}}" wx:key="*this" 
                style="background-color: {{index % 7 === 0 ? '#E0E0E0' : '#E0E0E0'}}"></view>
        </view>
      </view>
    </view>

    <view class="legend">
      <view class="legend-item" style="background:#4CAF50"><text>美味</text></view>
      <view class="legend-item" style="background:#F44336"><text>偏辣</text></view>
      <view class="legend-item" style="background:#2196F3"><text>偏咸</text></view>
      <view class="legend-item" style="background:#FFC107"><text>油腻</text></view>
      <view class="legend-item" style="background:#9C27B0"><text>清淡</text></view>
      <view class="legend-item" style="background:#F8BBD0"><text>一般</text></view>
    </view>
  </view>

  <!-- Cart Card (Logic Integrated) -->
  <view class="card cart-card" wx:if="{{activeView === 'cart'}}">
    
    <!-- State 1: Empty -->
    <view class="empty-state" wx:if="{{todayStatus === 'empty'}}">
      <text class="empty-text">今天还没想好吃什么...</text>
      <button class="action-btn primary" bindtap="goToMenu">去点菜</button>
    </view>

    <!-- State 2: Planned -->
    <view class="planned-state" wx:elif="{{todayStatus === 'planned'}}">
      <view class="card-header">
        <text class="card-title">今日菜单</text>
      </view>
      <view class="menu-list">
        <view class="menu-item" wx:for="{{todayMenu.items}}" wx:key="name">
          <image class="menu-img" src="{{item.img}}" mode="aspectFill"></image>
          <text class="menu-name">{{item.name}}</text>
        </view>
      </view>
      <button class="action-btn success" bindtap="completeCooking">开始做饭 & 完成</button>
    </view>

    <!-- State 3: Completed -->
    <view class="completed-state" wx:else>
      <text class="completed-text">今日打卡成功！🎉</text>
      <button class="action-btn secondary" bindtap="goToDiary">查看食记</button>
    </view>

  </view>
</view>