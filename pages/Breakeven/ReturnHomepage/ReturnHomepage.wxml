<view class="container">
  <view class="title">åˆ°æœŸä¾¿ç­¾</view>

  <view class="seg">
    <view class="seg-item {{mode==='expire'?'active':''}}" bindtap="switchMode" data-mode="expire">ğŸ“Œ åˆ°æœŸäº†å—</view>
    <view class="seg-item {{mode==='roi'?'active-green':''}}" bindtap="switchMode" data-mode="roi">ğŸ§¾ ä½¿ç”¨æˆæœ¬</view>
  </view>

  <view class="search card">
    <input class="search-input" placeholder="æœç´¢åç§°æˆ–åˆ†ç±»" value="{{keyword}}" bindinput="onKeyword" />
    <view class="search-icon">ğŸ”</view>
  </view>

  <!-- summary -->
  <view class="summary card {{mode==='expire'?'summary-purple':'summary-green'}}">

    <!-- åˆ°æœŸæ¨¡å¼ä¿æŒåŸæ · -->
    <block wx:if="{{mode==='expire'}}">
      <view class="sum-left">
        <view class="sum-label">æ€»èµ„äº§</view>
        <view class="sum-value">Â¥{{summary.totalAsset}}</view>
        <view class="sum-mini">
          <text>ğŸ“… 30å¤©å†…å°†åˆ°æœŸ </text><text class="sum-strong">{{summary.expireSoonCount}}</text><text> ä»¶</text>
        </view>
      </view>
      <view class="sum-right">
        <view class="sum-mini-right">
          <text>ğŸ“¦ å…¨éƒ¨ç‰©å“ </text><text class="sum-strong">{{summary.totalCount}}</text><text> ä»¶</text>
        </view>
        <view class="date-pill">{{today}}</view>
      </view>
    </block>

    <!-- ä½¿ç”¨æˆæœ¬æ¨¡å¼ï¼šä¸‰åˆ—å¸ƒå±€ -->
    <block wx:if="{{mode==='roi'}}">
      <view class="sum-3col">
        <!-- å·¦åˆ— -->
        <view class="sum-col left">
          <view class="sum-label">æ€»æŠ•å…¥</view>
          <view class="sum-value">Â¥{{summary.totalAsset}}</view>
          <view class="sum-mini">
            <text>ğŸ“… ä»Šæ—¥æ‘Šé”€ </text><text class="sum-strong">Â¥{{summary.todayCost}}</text>
          </view>
        </view>

        <!-- ä¸­åˆ— -->
        <view class="sum-col mid">
          <view class="sum-mini">ğŸ”¥ æœ€é«˜æ—¥æˆæœ¬</view>
          <view class="sum-value-sm">Â¥{{summary.maxDailyCost}}/å¤©</view>
        </view>

        <!-- å³åˆ— -->
        <view class="sum-col right">
          <view class="date-pill">{{today}}</view>
        </view>
      </view>

      <view class="sum-bottom muted">æœ€é«˜æ—¥æˆæœ¬ç‰©å“ï¼š{{summary.maxDailyName}}</view>
    </block>

  </view>


  <!-- categories -->
  <view class="cat-wrap card {{mode==='expire'?'cat-purple':'cat-green'}}">
    <view class="cat-head">
      <text>åˆ†ç±»</text>
      <text class="manage" bindtap="goCategories">ç®¡ç† ></text>
    </view>

    <scroll-view scroll-x="true" class="cat-scroll">
      <view class="cat-item {{selectedCatId===''?'cat-active':''}}" bindtap="pickCat" data-id="">
        <view class="cat-num">{{catCounts.all || 0}}</view>
        <view class="cat-name">å…¨éƒ¨ ></view>
      </view>

      <block wx:for="{{categories}}" wx:key="_id">
        <view class="cat-item {{selectedCatId===item._id?'cat-active':''}}" bindtap="pickCat" data-id="{{item._id}}">
          <view class="cat-num">{{catCounts[item._id] || 0}}</view>
          <view class="cat-name">{{item.name}} ></view>
        </view>
      </block>
    </scroll-view>

    <!-- status filter -->
    <view class="pill-row">
      <view wx:if="{{mode==='expire'}}" class="pill {{statusFilter==='all'?'pill-active':''}}" bindtap="pickStatus"
        data-s="all">å…¨éƒ¨ç‰©å“</view>
      <view wx:if="{{mode==='expire'}}" class="pill {{statusFilter==='valid'?'pill-active':''}}" bindtap="pickStatus"
        data-s="valid">æœªè¿‡æœŸ</view>
      <view wx:if="{{mode==='expire'}}" class="pill {{statusFilter==='expired'?'pill-active':''}}" bindtap="pickStatus"
        data-s="expired">å·²è¿‡æœŸ</view>

      <view wx:if="{{mode==='roi'}}" class="pill {{statusFilter==='all'?'pill-active':''}}" bindtap="pickStatus"
        data-s="all">å…¨éƒ¨ç‰©å“</view>
      <view wx:if="{{mode==='roi'}}" class="pill {{statusFilter==='using'?'pill-active':''}}" bindtap="pickStatus"
        data-s="using">ä½¿ç”¨ä¸­</view>
      <view wx:if="{{mode==='roi'}}" class="pill {{statusFilter==='archived'?'pill-active':''}}" bindtap="pickStatus"
        data-s="archived">å½’æ¡£</view>
    </view>
  </view>

  <view class="list card">
    <view class="list-head">
      <text>å…¨éƒ¨ Â· {{filtered.length}} æ¡</text>
      <picker mode="selector" range="{{sortOptions}}" value="{{sortIndex}}" bindchange="onSort">
        <view class="sort">æ’åºï¼š{{sortOptions[sortIndex]}} â†‘</view>
      </picker>
    </view>

    <block wx:if="{{filtered.length===0}}">
      <view class="empty muted">æš‚æ— æ•°æ®ï¼Œç‚¹å‡»å³ä¸‹è§’ + æ·»åŠ ç‰©å“</view>
    </block>

    <block wx:for="{{filtered}}" wx:key="_id">
      <view class="cost-card" bindtap="goDetail" data-id="{{item._id}}">

<view class="cost-left">
  <view class="cost-name">{{item.name}}</view>

  <view class="cost-price">
    <text class="cost-price-num">Â¥{{item.buyPrice}}</text>
    <text class="muted">(ä»·æ ¼)</text>
  </view>

  <text>Â¥{{item._dailyCostStr}}/å¤©</text>
</view>

<view class="cost-mid">
  <view class="tag">{{item.categoryName || 'æœªåˆ†ç±»'}}</view>
  <view class="tag tag-status">{{item.statusText}}</view>
  <view class="cost-date">ğŸ“… {{item.buyDate}}</view>
</view>

<view class="days-box">
  <view class="days-num">{{item._useDays}}</view>
  <view class="days-text">ä½¿ç”¨å¤©æ•°</view>
</view>

</view>


      <view class="divider"></view>
    </block>

  </view>

  <view class="fab" bindtap="goAdd">+</view>
</view>